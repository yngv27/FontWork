<!DOCTYPE html>
<html>
<body>

<p>Image to use:</p>

<!-- img id="TheFont2" width="800" height="20" src="knxt-20.jv.png" alt="The Font" -->
<!--
<img id="TheFont" width="330" height="20" src="knxt-20.Nums.png" alt="The Font">
<img id="TheFont" width="800" height="20" src="knxt-20.jv.2.png" alt="The Font">
             -->
<img id="TheFont" width="540" height="13" src="omnitwo.png" alt="The Font">

<p>Canvas:</p>

<canvas id="myCanvas" width="540" height="13" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.
</canvas>
<p>
<textarea id="src" cols="120"  rows="20" style="font-family: Courier">Temporary</textarea>

<script>
window.onload = function() {

    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    var img = document.getElementById("TheFont");
    ctx.drawImage(img, 0, 0);

    var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);

	// invert colors
	var i;
	for (i = 0; i < imgData.data.length; i += 4) {
	  imgData.data[i] = 255-imgData.data[i];
	  imgData.data[i + 1] = 255-imgData.data[i + 1];
	  imgData.data[i + 2] = 255-imgData.data[i + 2];
	  imgData.data[i + 3] = 255;
	}

	ctx.putImageData(imgData, 0, 0);

	let byteBuilder = 0, bitCounter = 0;
	let font = [];

	let omnigo_widths = [
	     3, 2, 4, 6, 6, 8, 6, 2,
             4, 4, 5, 6, 3, 5, 3, 4,
             6, 4, 6, 6, 6, 6, 6, 6,
             6, 6, 4, 5, 6, 5, 6, 6,
             11, 7, 7, 7, 7, 7, 6, 7,
             7, 4, 5, 7, 6, 8, 7, 7,
             7, 7, 7, 6, 6, 7, 7, 9,
             7, 7, 7, 3, 4, 3, 7, 7,
             3, 6, 6, 6, 6, 6, 5, 6,
             6, 2, 4, 6, 2, 8, 6, 6,
             6, 6, 4, 5, 4, 6, 6, 8,
             6, 6, 5, 4, 2, 4, 7,
             ];

  let knxt_widths = [5,3,5,9,9,9,9,4,
              6,6,9,9,4,9,3,9,
              9, 6, 9, 9, 9, 9, 9, 9, 9, 9,
              3, 4, 7, 9, 7, 9, 9, 9, 9, 9,
              3, 4, 7, 9, 11,9,9,9,9,9,9,9
             ];

  let knxt_num_widths =
              [
           // sp !  "  #  $. %. &. '
              6, 3, 0, 9, 9, 9, 9, 0,
           // (. ). *. +. ,  -  .  /
              5, 5, 9, 9, 4, 9, 3, 8,
           // 0-9
              9, 6, 9, 9, 9, 9, 9, 9, 9, 9,
           // :  ;  <. =. >. ?  @
              3, 4, 7, 9, 7, 9, 9,
           // A-F
              9, 9, 9, 9, 9, 8,
           // G-Z
              0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
           // [. \. ]. ^
              5, 8, 5, 9, 9, 3
             ];

  let height = canvas.height;
  let width = canvas.width;
  console.log("h/w", height, width);


	for (let fontX = 0; fontX <  width; fontX++) {
	  for (let fontY = 0; fontY < height; fontY++ ) {
      let bdata = ctx.getImageData(fontX, fontY, 1, 1);
      if(bdata.data[0] > 128) {
        byteBuilder++;
      }
      //console.log('bdata/bitctr/bbldr = '+bdata.data[0]+','+bitCounter +',' +byteBuilder);
      if(bitCounter++ >= 7) {
        console.log('pushing ' + ('00000000'+byteBuilder.toString(2)).slice(-8));
        font.push(byteBuilder);
        byteBuilder = 0;
        bitCounter = 0;
      } else {
        byteBuilder <<= 1;
      }
    }
  }

  let widthStr = JSON.stringify(omnigo_widths);
  let fontStr = JSON.stringify(font);
  let src = document.getElementById('src')
  let h = 'let fontStr = ' + fontStr + ';';
  h = h + '\nlet widthStr = "' + widthStr + '";';
  src.innerHTML = h;



};
</script>

</body>
</html>
<!--
let font =
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,254,96,0,0,0,0,0,48,0,0,0,0,48,0,0,0,0,0,0,0,18,0,1,32,0,255,192,1,32,0,255,192,1,32,0,18,0,0,0,0,0,0,14,8,1,16,64,32,130,7,255,240,32,130,1,4,64,8,56,0,0,0,0,0,0,0,0,12,6,1,33,128,12,96,0,24,192,6,18,1,128,192,0,0,0,0,0,0,56,1,204,64,35,2,2,56,32,28,100,0,1,128,0,102,0,0,0,0,0,0,128,0,48,0,0,0,0,0,0,0,127,0,56,14,4,0,16,0,0,0,0,0,64,1,3,128,224,7,240,0,0,0,0,0,0,4,0,2,72,0,21,0,0,224,0,21,0,2,72,0,4,0,0,0,0,0,0,0,64,0,4,0,0,64,0,63,128,0,64,0,4,0,0,64,0,0,0,0,0,0,0,16,0,6,0,0,0,0,0,0,0,0,0,64,0,4,0,0,64,0,4,0,0,64,0,4,0,0,64,0,0,0,0,0,0,0,96,0,0,0,0,0,0,6,0,1,128,0,96,0,24,0,6,0,1,128,0,0,0,0,0,0,15,248,1,2,64,32,66,2,8,32,33,2,1,32,64,15,248,0,0,0,0,0,0,64,0,8,0,1,0,0,63,254,0,0,0,0,0,0,192,96,16,10,2,1,32,32,34,2,4,32,16,130,0,240,32,0,0,0,0,0,8,8,1,0,64,32,130,2,8,32,32,130,1,20,64,14,56,0,0,0,0,0,0,3,128,0,200,0,48,128,12,8,3,0,128,0,254,0,0,128,0,0,0,0,0,63,8,2,16,64,33,2,2,16,32,33,2,2,8,64,32,120,0,0,0,0,0,0,63,128,12,132,1,16,32,33,2,2,16,32,32,132,0,7,128,0,0,0,0,0,32,0,2,0,0,32,0,2,0,224,32,112,2,56,0,60,0,0,0,0,0,0,0,227,128,17,68,2,8,32,32,130,2,8,32,17,68,0,227,128,0,0,0,0,0,15,0,1,8,32,32,66,2,4,32,32,68,1,9,128,15,224,0,0,0,0,0,0,48,96,0,0,0,0,0,0,1,0,48,96,0,0,0,0,0,0,64,0,10,0,1,16,0,32,128,4,4,0,0,0,0,0,0,17,0,1,16,0,17,0,1,16,0,17,0,1,16,0,17,0,0,0,0,0,0,4,4,0,32,128,1,16,0,10,0,0,64,0,0,0,0,0,0,192,0,16,0,2,0,0,32,118,2,8,0,17,0,0,224,0,0,0,0,0,0,7,248,0,128,64,17,226,1,33,32,18,18,0,146,32,7,244,0,0,0,0,0,0,1,224,1,240,0,225,0,48,16,0,225,0,1,240,0,1,224,0,0,0,0,0,63,254,2,16,32,33,2,2,16,32,33,2,1,40,64,12,120,0,0,0,0,0,0,255,128,16,4,2,0,32,32,2,2,0,32,16,4,0,128,128,0,0,0,0,0,63,254,2,0,32,32,2,2,0,32,32,2,1,0,64,15,248,0,0,0,0,0,3,255,224,32,130,2,8,32,32,130,2,8,32,32,2,2,0,32,0,0,0,0,0,63,254,2,8,0,32,128,2,8,0,32,128,2,0,0,32,0,0,0,0,0,0,0,255,128,16,4,2,0,32,32,2,2,4,32,16,68,0,135,224,0,0,0,0,0,63,254,0,8,0,0,128,0,8,0,0,128,0,8,0,63,254,0,0,0,0,0,2,0,32,63,254,2,0,32,0,0,0,0,0,0,8,0,0,64,0,2,0,0,32,0,2,0,0,64,63,248,0,0,0,0,0,3,255,224,0,128,0,20,0,2,32,0,65,0,8,8,3,0,96,0,0,0,0,0,63,254,0,0,32,0,2,0,0,32,0,2,0,0,32,0,2,0,0,0,0,0,3,255,224,12,0,0,48,0,0,192,0,48,0,12,0,3,255,224,0,0,0,0,0,63,254,0,192,0,3,0,0,12,0,0,48,0,0,192,63,254,0,0,0,0,0,0,255,128,16,4,2,0,32,32,2,2,0,32,16,4,0,255,128,0,0,0,0,0,63,254,2,4,0,32,64,2,4,0,32,64,1,8,0,15,0,0,0,0,0,0,0,255,128,16,4,2,0,32,32,2,2,0,160,16,4,0,255,160,0,0,0,0,0,63,254,2,4,0,32,64,2,4,0,32,96,1,9,128,15,6,0,0,0,0,0,0,224,128,17,4,2,8,32,32,130,2,8,32,16,68,0,131,128,0,0,0,0,0,32,0,2,0,0,32,0,3,255,224,32,0,2,0,0,32,0,0,0,0,0,0,3,255,128,0,4,0,0,32,0,2,0,0,32,0,4,3,255,128,0,0,0,0,0,60,0,0,60,0,0,56,0,0,96,0,56,0,60,0,60,0,0,0,0,0,0,3,224,0,1,224,0,1,224,1,224,3,224,0,1,224,0,1,224,1,224,3,224,0,0,0,0,0,0,48,6,0,193,128,3,96,0,8,0,3,96,0,193,128,48,6,0,0,0,0,0,3,0,0,12,0,0,48,0,0,254,0,48,0,12,0,3,0,0,0,0,0,0,0,32,30,2,2,32,32,66,2,8,32,33,2,2,32,32,60,2,0,0,0,0,0,7,255,240,64,1,4,0,16,0,0,0,0,0,48,0,0,192,0,3,0,0,12,0,0,48,0,0,192,0,0,0,0,0,64,1,4,0,16,127,255,0,0,0,0,0,0,64,0,8,0,1,0,0,32,0,1,0,0,8,0,0,64,0,0,0,0,0,0,0,2,0,0,32,0,2,0,0,32,0,2,0,0,32,0,2,0,0,0,0,0,3,0,0,8,0,0,0,0,0,0,0,1,128,1,36,0,36,32,2,66,0,36,32,2,68,0,31,224,0,0,0,0,0,63,254,0,16,64,2,2,0,32,32,2,2,0,16,64,0,248,0,0,0,0,0,0,15,128,1,4,0,32,32,2,2,0,32,32,2,2,0,16,64,0,0,0,0,0,0,248,0,16,64,2,2,0,32,32,2,2,0,16,64,63,254,0,0,0,0,0,0,15,128,1,36,0,34,32,2,34,0,34,32,1,34,0,14,64,0,0,0,0,0,2,0,0,32,0,31,254,2,32,0,34,0,2,0,0,0,0,0,0,0,0,248,64,16,66,2,2,32,32,34,2,2,32,16,68,3,255,128,0,0,0,0,3,255,224,1,0,0,32,0,2,0,0,32,0,1,0,0,15,224,0,0,0,0,0,2,0,1,191,224,0,0,0,0,0,0,0,128,0,4,0,0,65,191,248,0,0,0,0,0,63,254,0,2,0,0,32,0,5,0,0,136,0,16,64,2,2,0,0,0,0,0,2,0,0,63,252,0,0,32,0,2,0,0,0,0,0,0,63,224,2,0,0,32,0,1,254,0,32,0,2,0,0,31,224,0,0,0,0,0,3,254,0,16,0,2,0,0,32,0,2,0,0,16,0,0,254,0,0,0,0,0,0,15,128,1,4,0,32,32,2,2,0,32,32,1,4,0,15,128,0,0,0,0,0,3,255,192,16,64,2,2,0,32,32,2,2,0,16,64,0,248,0,0,0,0,0,0,15,128,1,4,0,32,32,2,2,0,32,32,1,4,0,63,252,0,0,0,0,0,3,254,0,8,0,1,0,0,32,0,2,0,0,32,0,1,0,0,0,0,0,0,0,28,64,2,34,0,34,32,2,34,0,34,32,2,34,0,17,192,0,0,0,0,0,2,0,0,32,0,15,252,0,32,32,2,2,0,0,32,0,0,0,0,0,3,248,0,0,64,0,2,0,0,32,0,2,0,0,64,3,254,0,0,0,0,0,0,56,0,0,96,0,1,128,0,6,0,1,128,0,96,0,56,0,0,0,0,0,0,3,240,0,0,224,0,48,0,28,0,0,48,0,0,224,3,240,0,0,0,0,0,0,48,96,0,136,0,5,0,0,32,0,5,0,0,136,0,48,96,0,0,0,0,0,3,128,64,6,4,0,25,128,0,96,0,24,0,6,0,3,128,0,0,0,0,0,0,32,96,2,10,0,33,32,2,34,0,36,32,2,130,0,48,32,0,0,0,0,0,0,128,3,247,224,64,1,0,0,0,0,0,0,0,0,63,254,0,0,0,0,0,0,0,0,64,1,3,247,224,0,128,0,0,0,0,0,0,128,0,16,0,1,0,0,8,0,0,64,0,4,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

let widths =
              [
           // sp !  "  #  $. %. &. '
              6, 3, 5, 9, 9, 9, 9, 4,
           // (. ). *. +. ,  -  .  /
              5, 5, 9, 9, 4, 9, 3, 9,
           // 0-9
              10, 6, 9, 9, 9, 9, 9, 9, 9, 9,
           // :  ;  <. =. >. ?  @
              3, 4, 7, 9, 7, 9, 9,
           // A-F
              9, 9, 9, 9, 9, 9,
           // G-Z
              9,9,5,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
           // [. \. ]. ^  _. `
              5, 8, 5, 9, 9, 4,
                // a-h
                9, 9, 9, 9, 9, 8, 9, 9,
                // i-z
                4,6,9,6,9,9,9,9, 9,9,9,8,9,9,9,9,9,9,
                5,5,5,9
             ];
console.log(btoa(font));
console.log(btoa(widths));
g.setFontCustom(E.toString(font), 32, E.toString(widths), 256 | 20);

//g.setFontCustom(atob(f2), 32, atob(w2), 256 | 20);
g.clear();
g.drawString("uu vv ww xx yy zz",4,20);
g.drawString("{{ || }} ~~",4,45);
g.drawString("aa bb cc dd ee ff gg hh ii jj",4,70);
g.drawString("kk ll mm nn oo pp qq rr ss tt", 4, 95);
>
